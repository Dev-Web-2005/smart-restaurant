<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Socket.IO Test Client - Smart Restaurant</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 50px auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        border-bottom: 2px solid #4caf50;
        padding-bottom: 10px;
      }
      .section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      input,
      button,
      textarea {
        padding: 10px;
        margin: 5px 0;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }
      input {
        width: 400px;
      }
      button {
        background: #4caf50;
        color: white;
        border: none;
        cursor: pointer;
        font-weight: bold;
      }
      button:hover {
        background: #45a049;
      }
      button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }
      .btn-disconnect {
        background: #f44336;
      }
      .btn-disconnect:hover {
        background: #da190b;
      }
      #logs {
        height: 400px;
        overflow-y: auto;
        background: #1e1e1e;
        color: #d4d4d4;
        padding: 15px;
        border-radius: 4px;
        font-family: "Courier New", monospace;
        font-size: 12px;
      }
      .log-entry {
        margin: 5px 0;
        padding: 5px;
        border-left: 3px solid #4caf50;
        padding-left: 10px;
      }
      .log-sent {
        border-left-color: #2196f3;
        background: rgba(33, 150, 243, 0.1);
      }
      .log-received {
        border-left-color: #4caf50;
        background: rgba(76, 175, 80, 0.1);
      }
      .log-error {
        border-left-color: #f44336;
        background: rgba(244, 67, 54, 0.1);
      }
      .log-info {
        border-left-color: #ff9800;
        background: rgba(255, 152, 0, 0.1);
      }
      .status {
        display: inline-block;
        padding: 5px 15px;
        border-radius: 20px;
        font-weight: bold;
        margin-left: 10px;
      }
      .status-connected {
        background: #4caf50;
        color: white;
      }
      .status-disconnected {
        background: #f44336;
        color: white;
      }
      label {
        display: block;
        margin-top: 10px;
        font-weight: bold;
        color: #555;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ”Œ Socket.IO Test Client - Smart Restaurant</h1>

      <div class="section">
        <h2>ğŸ“¡ Connection Settings</h2>
        <label>Server URL:</label>
        <input
          type="text"
          id="serverUrl"
          value="http://localhost:8888/realtime"
          placeholder="http://localhost:8888/realtime"
        />

        <h3>ğŸ”‘ Authentication Mode</h3>
        <div>
          <input
            type="radio"
            name="authMode"
            value="jwt"
            id="authJwt"
            checked
          />
          <label for="authJwt" style="display: inline"
            >JWT Token (Authenticated User)</label
          >
        </div>
        <div>
          <input type="radio" name="authMode" value="guest" id="authGuest" />
          <label for="authGuest" style="display: inline">Guest Mode</label>
        </div>

        <div id="jwtFields">
          <label>JWT Token:</label>
          <input
            type="text"
            id="jwtToken"
            placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
          />

          <label>Tenant ID:</label>
          <input
            type="text"
            id="jwtTenantId"
            value="d95e73fb-b861-40eb-ba09-eff4b79084ef"
            placeholder="tenant-uuid"
          />
        </div>

        <div id="guestFields" style="display: none">
          <label>Tenant ID:</label>
          <input
            type="text"
            id="guestTenantId"
            value="d95e73fb-b861-40eb-ba09-eff4b79084ef"
            placeholder="tenant-uuid"
          />

          <label>Table ID:</label>
          <input
            type="text"
            id="guestTableId"
            value="66094127-3af3-4559-9cee-6f5b3f9e3d40"
            placeholder="table-uuid"
          />

          <label>Guest Name (optional):</label>
          <input type="text" id="guestName" placeholder="Guest at Table 5" />
        </div>

        <div style="margin-top: 15px">
          <button id="btnConnect">ğŸŸ¢ Connect</button>
          <button id="btnDisconnect" class="btn-disconnect" disabled>
            ğŸ”´ Disconnect
          </button>
          <span id="status" class="status status-disconnected"
            >DISCONNECTED</span
          >
        </div>
      </div>

      <div class="section">
        <h2>ğŸ“¨ Send Messages</h2>

        <h3>Join Order Room</h3>
        <label>Order ID:</label>
        <input
          type="text"
          id="orderId"
          value="3ee2b82f-9663-4a95-9775-d17c1a05b3c8"
          placeholder="order-uuid"
        />
        <button id="btnJoinOrder" disabled>ğŸ“¥ Join Order Room</button>
        <button id="btnLeaveOrder" disabled>ğŸ“¤ Leave Order Room</button>

        <h3>Heartbeat</h3>
        <button id="btnPing" disabled>ğŸ’“ Send Ping</button>

        <h3>Custom Message</h3>
        <label>Event Name:</label>
        <input type="text" id="customEvent" placeholder="order.status_update" />
        <label>Payload (JSON):</label>
        <textarea id="customPayload" rows="4" style="width: 400px">
{
  "orderId": "123",
  "status": "ACCEPTED"
}</textarea
        >
        <button id="btnSendCustom" disabled>ğŸš€ Send Custom Message</button>
      </div>

      <div class="section">
        <h2>ğŸ“‹ Event Logs</h2>
        <button onclick="clearLogs()">ğŸ—‘ï¸ Clear Logs</button>
        <div id="logs"></div>
      </div>
    </div>

    <script>
      let socket = null;
      const logsDiv = document.getElementById("logs");

      // Toggle auth mode fields
      document.querySelectorAll('input[name="authMode"]').forEach((radio) => {
        radio.addEventListener("change", (e) => {
          const isGuest = e.target.value === "guest";
          document.getElementById("jwtFields").style.display = isGuest
            ? "none"
            : "block";
          document.getElementById("guestFields").style.display = isGuest
            ? "block"
            : "none";
        });
      });

      function log(message, type = "info") {
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = document.createElement("div");
        logEntry.className = `log-entry log-${type}`;
        logEntry.textContent = `[${timestamp}] ${message}`;
        logsDiv.appendChild(logEntry);
        logsDiv.scrollTop = logsDiv.scrollHeight;
      }

      function clearLogs() {
        logsDiv.innerHTML = "";
      }

      function updateConnectionStatus(connected) {
        const statusEl = document.getElementById("status");
        statusEl.textContent = connected ? "CONNECTED" : "DISCONNECTED";
        statusEl.className = `status status-${
          connected ? "connected" : "disconnected"
        }`;

        document.getElementById("btnConnect").disabled = connected;
        document.getElementById("btnDisconnect").disabled = !connected;
        document.getElementById("btnJoinOrder").disabled = !connected;
        document.getElementById("btnLeaveOrder").disabled = !connected;
        document.getElementById("btnPing").disabled = !connected;
        document.getElementById("btnSendCustom").disabled = !connected;
      }

      // Connect
      document.getElementById("btnConnect").addEventListener("click", () => {
        const serverUrl = document.getElementById("serverUrl").value;
        const authMode = document.querySelector(
          'input[name="authMode"]:checked'
        ).value;

        let authData = {};

        if (authMode === "jwt") {
          const token = document.getElementById("jwtToken").value;
          const tenantId = document.getElementById("jwtTenantId").value;

          if (!token || !tenantId) {
            alert("Please provide JWT token and Tenant ID");
            return;
          }

          authData = {
            token: token,
            tenantId: tenantId,
          };
        } else {
          const tenantId = document.getElementById("guestTenantId").value;
          const tableId = document.getElementById("guestTableId").value;
          const guestName = document.getElementById("guestName").value;

          if (!tenantId || !tableId) {
            alert("Please provide Tenant ID and Table ID for guest mode");
            return;
          }

          authData = {
            tenantId: tenantId,
            tableId: tableId,
            guestName: guestName || `Guest at ${tableId}`,
          };
        }

        log(`ğŸ”Œ Connecting to ${serverUrl}...`, "info");
        log(`ğŸ”‘ Auth Mode: ${authMode.toUpperCase()}`, "info");
        log(`ğŸ“¦ Auth Data: ${JSON.stringify(authData)}`, "info");

        socket = io(serverUrl, {
          auth: authData,
          transports: ["websocket", "polling"],
        });

        // Connection events
        socket.on("connect", () => {
          log("âœ… Connected successfully!", "received");
          log(`ğŸ“ Socket ID: ${socket.id}`, "info");
          updateConnectionStatus(true);
        });

        socket.on("disconnect", (reason) => {
          log(`âŒ Disconnected: ${reason}`, "error");
          updateConnectionStatus(false);
        });

        socket.on("connect_error", (error) => {
          log(`âŒ Connection Error: ${error.message}`, "error");
          updateConnectionStatus(false);
        });

        // Server events
        socket.on("connection.success", (data) => {
          log("ğŸ‰ Connection Success Event:", "received");
          log(JSON.stringify(data, null, 2), "received");
        });

        socket.on("error", (data) => {
          log("âŒ Error Event:", "error");
          log(JSON.stringify(data, null, 2), "error");
        });

        socket.on("order.joined", (data) => {
          log("âœ… Order Joined:", "received");
          log(JSON.stringify(data, null, 2), "received");
        });

        socket.on("order.left", (data) => {
          log("ğŸ‘‹ Order Left:", "received");
          log(JSON.stringify(data, null, 2), "received");
        });

        socket.on("pong", (data) => {
          log("ğŸ’“ Pong received:", "received");
          log(JSON.stringify(data, null, 2), "received");
        });

        // Order events
        socket.on("order.items.new", (data) => {
          log("ğŸ†• New Order Items:", "received");
          log(JSON.stringify(data, null, 2), "received");
        });

        socket.on("order.items.accepted", (data) => {
          log("âœ… Items Accepted:", "received");
          log(JSON.stringify(data, null, 2), "received");
        });

        socket.on("order.items.preparing", (data) => {
          log("ğŸ‘¨â€ğŸ³ Items Preparing:", "received");
          log(JSON.stringify(data, null, 2), "received");
        });

        socket.on("order.items.ready", (data) => {
          log("ğŸ½ï¸ Items Ready:", "received");
          log(JSON.stringify(data, null, 2), "received");
        });

        socket.on("order.items.served", (data) => {
          log("âœ… Items Served:", "received");
          log(JSON.stringify(data, null, 2), "received");
        });

        // Catch-all for other events
        socket.onAny((eventName, ...args) => {
          if (
            !["connect", "disconnect", "connection.success", "error"].includes(
              eventName
            )
          ) {
            log(`ğŸ“¨ Event: ${eventName}`, "received");
            log(JSON.stringify(args, null, 2), "received");
          }
        });
      });

      // Disconnect
      document.getElementById("btnDisconnect").addEventListener("click", () => {
        if (socket) {
          socket.disconnect();
          socket = null;
          log("ğŸ”Œ Manually disconnected", "info");
        }
      });

      // Join Order Room
      document.getElementById("btnJoinOrder").addEventListener("click", () => {
        const orderId = document.getElementById("orderId").value;
        if (!orderId) {
          alert("Please provide Order ID");
          return;
        }

        log(`ğŸ“¤ Sending: order.join`, "sent");
        log(`Payload: {"orderId": "${orderId}"}`, "sent");

        socket.emit("order.join", { orderId: orderId }, (response) => {
          log("ğŸ“¥ ACK Response from order.join:", "received");
          log(JSON.stringify(response, null, 2), "received");
        });
      });

      // Leave Order Room
      document.getElementById("btnLeaveOrder").addEventListener("click", () => {
        const orderId = document.getElementById("orderId").value;
        if (!orderId) {
          alert("Please provide Order ID");
          return;
        }

        log(`ğŸ“¤ Sending: order.leave`, "sent");
        log(`Payload: {"orderId": "${orderId}"}`, "sent");

        socket.emit("order.leave", { orderId: orderId }, (response) => {
          log("ğŸ“¥ ACK Response from order.leave:", "received");
          log(JSON.stringify(response, null, 2), "received");
        });
      });

      // Ping
      document.getElementById("btnPing").addEventListener("click", () => {
        log(`ğŸ“¤ Sending: ping`, "sent");
        socket.emit("ping", {}, (response) => {
          log("ğŸ“¥ ACK Response from ping:", "received");
          log(JSON.stringify(response, null, 2), "received");
        });
      });

      // Send Custom Message
      document.getElementById("btnSendCustom").addEventListener("click", () => {
        const eventName = document.getElementById("customEvent").value;
        const payload = document.getElementById("customPayload").value;

        if (!eventName) {
          alert("Please provide event name");
          return;
        }

        let parsedPayload;
        try {
          parsedPayload = JSON.parse(payload);
        } catch (e) {
          alert("Invalid JSON payload: " + e.message);
          return;
        }

        log(`ğŸ“¤ Sending: ${eventName}`, "sent");
        log(`Payload: ${JSON.stringify(parsedPayload, null, 2)}`, "sent");

        socket.emit(eventName, parsedPayload, (response) => {
          log(`ğŸ“¥ ACK Response from ${eventName}:`, "received");
          log(JSON.stringify(response, null, 2), "received");
        });
      });
    </script>
  </body>
</html>
